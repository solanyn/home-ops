apiVersion: gateway.envoyproxy.io/v1alpha1
kind: SecurityPolicy
metadata:
  name: kubeflow-oidc
  namespace: kubeflow
spec:
  targetRefs:
    - group: gateway.networking.k8s.io
      kind: HTTPRoute
      name: kubeflow
      namespace: istio-system
  oidc:
    provider:
      issuer: https://id.goyangi.io
    clientIDRef:
      name: kubeflow-secret
    clientSecret:
      name: kubeflow-secret
    redirectURL: https://kubeflow.goyangi.io/oauth2/callback
    logoutPath: /oauth2/logout
    scopes:
      - openid
      - profile
      - email
      - offline_access
    jwt:
      providers:
        - name: pocket-id
          issuer: https://id.goyangi.io
          claimToHeaders:
            - claim: email
              header: kubeflow-userid
            - claim: groups
              header: kubeflow-groups
