---
apiVersion: v1
kind: ConfigMap
metadata:
  name: pipeline-install-config
data:
  warning: ""
  # Legacy
  dbHost: mariadb.database.svc.cluster.local
  dbPort: "3306"
  # App Config
  appName: pipeline
  cronScheduleTimezone: "Australia/Sydney"
  # Workflow Image Config
  launcherImage: ghcr.io/kubeflow/kfp-launcher:2.4.1
  driverImage: ghcr.io/kubeflow/kfp-driver:2.4.1
  # Cache Config
  cacheImage: registry.k8s.io/busybox
  # Bucket Config
  bucketName: kfp-pipelines
  bucketRegion: "us-east-1"
  # Object Store Config
  bucketHost: minio.default.svc.cluster.local
  bucketSecure: false
  bucketPort: "9000"
  # MySQL Config
  dbType: mysql
  mysqlHost: mariadb.database.svc.cluster.local
  mysqlPort: "3306"
  mlmdDb: kfp_metadata
  cacheDb: kfp_cache
  pipelineDb: kfp_pipelines
  # UserID Config
  USERID_HEADER: kubeflow-userid
  USERID_PREFIX: ""
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: workflow-controller-configmap
data:
  artifactRepository: |
    archiveLogs: true
    s3:
      endpoint: "minio.default.svc.cluster.local:9000"
      bucket: "kfp-pipelines"
      keyFormat: "artifacts/{{workflow.name}}/{{workflow.creationTimestamp.Y}}/{{workflow.creationTimestamp.m}}/{{workflow.creationTimestamp.d}}/{{pod.name}}"
      insecure: true
      accessKeySecret:
        name: kubeflow-secret
        key: KUBEFLOW_PIPELINES_ACCESS_KEY_ID
      secretKeySecret:
        name: kubeflow-secret
        key: KUBEFLOW_PIPELINES_SECRET_ACCESS_KEY
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: ml-pipeline-ui-configmap
data:
  viewer-pod-template: |
    {
      "spec": {
        "serviceAccountName": "default-editor",
        "containers": [
          {
            "env": [
              {
                "name": "AWS_REGION",
                "value": "us-east-1"
              },
              {
                "name": "S3_ENDPOINT",
                "value": "http://minio.default.svc.cluster.local:9000"
              },
              {
                "name": "AWS_ACCESS_KEY_ID",
                "valueFrom": {
                  "secretKeyRef": {
                    "name": "kubeflow-secret",
                    "key": "KUBEFLOW_PIPELINES_ACCESS_KEY_ID"
                  }
                }
              },
              {
                "name": "AWS_SECRET_ACCESS_KEY",
                "valueFrom": {
                  "secretKeyRef": {
                    "name": "kubeflow-secret",
                    "key": "KUBEFLOW_PIPELINES_SECRET_ACCESS_KEY"
                  }
                }
              }
            ]
          }
        ]
      }
    }
