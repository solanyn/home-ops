apiVersion: moco.cybozu.com/v1beta2
kind: MySQLCluster
metadata:
  name: mysql
  namespace: database
spec:
  replicas: 1
  backupPolicyName: daily
  primaryServiceTemplate:
    metadata:
      annotations:
        external-dns.alpha.kubernetes.io/hostname: mysql.goyangi.cloud
        lbipam.cilium.io/ips: 192.168.1.131
    spec:
      type: LoadBalancer
  podTemplate:
    spec:
      containers:
      - name: mysqld
        image: ghcr.io/cybozu-go/moco/mysql:8.4.4
        resources:
          requests:
            cpu: 10m
          limits:
            memory: 1Gi
    overwriteContainers:
      - name: agent
        resources:
          requests:
            cpu: 10m
            memory: 100Mi
      - name: slow-log
        resources:
          requests:
            cpu: 10m
            memory: 20Mi
      - name: moco-init
        resources:
          requests:
            cpu: 10m
            memory: 300Mi
      - name: mysqld-exporter
        resources:
          requests:
            cpu: 10m
            memory: 100Mi
  volumeClaimTemplates:
  - metadata:
      name: mysql-data
    spec:
      storageClassName: openebs-hostpath
      accessModes: [ "ReadWriteOnce" ]
      resources:
        requests:
          storage: 10Gi
  # restore:
  #   sourceName: moco-v0
  #   sourceNamespace: database
  #   # The restore point-in-time in RFC3339 format.
  #   restorePoint: "2021-05-26T12:34:56Z"
  #   jobConfig:
  #     serviceAccountName: default
  #     envFrom:
  #       - secretRef:
  #           name: moco-secret
  #     bucketConfig:
  #       bucketName: moco
  #       endpointURL: http://minio.default.svc.cluster.local:9000
  #       usePathStyle: true
  #     workVolume:
  #       persistentVolumeClaim:
  #         claimName: moco-backup

