apiVersion: k8s.mariadb.com/v1alpha1
kind: MariaDB
metadata:
  name: mariadb-cluster
spec:
  rootPasswordSecretKeyRef:
    name: mariadb-secret
    key: MARIADB_ROOT_PASSWORD
    generate: false
  storage:
    size: 10Gi
    storageClassName: openebs-hostpath
  replicas: 1
  imagePullPolicy: IfNotPresent
  galera:
    enabled: true
    config:
      reuseStorageVolume: true
  maxScale:
    enabled: true
    auth:
      adminUsername: mariadb
      adminPasswordSecretKeyRef:
        name: mariadb-secret
        key: MARIADB_ROOT_PASSWORD
      deleteDefaultAdmin: true
    kubernetesService:
      type: LoadBalancer
      metadata:
        annotations:
          external-dns.alpha.kubernetes.io/hostname: maraidb.goyangi.cloud
          lbipam.cilium.io/ips: 192.168.1.131
  myCnf: |
    [mariadb]
    bind-address=*
    default_storage_engine=InnoDB
    binlog_format=row
    innodb_autoinc_lock_mode=2
    max_allowed_packet=256M
  bootstrapFrom:
    s3:
      bucket: mariadb
      endpoint: http://minio.default.svc.cluster.local:9000
      accessKeyIdSecretKeyRef:
        name: mariadb-secret
        key: AWS_ACCESS_KEY_ID
      secretAccessKeySecretKeyRef:
        name: mariadb-secret
        key: AWS_SECRET_ACCESS_KEY
    restoreJob:
      resources:
        requests:
          cpu: 10m
          memory: 128Mi
        limits:
          memory: 1Gi
  resources:
    requests:
      cpu: 10m
      memory: 128Mi
    limits:
      memory: 1Gi
  metrics:
    enabled: true
  livenessProbe:
    periodSeconds: 10
    timeoutSeconds: 10
  readinessProbe:
    periodSeconds: 10
    timeoutSeconds: 10
  startupProbe:
    failureThreshold: 10
    periodSeconds: 10
    timeoutSeconds: 10
