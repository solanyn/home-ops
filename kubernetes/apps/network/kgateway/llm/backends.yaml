---
apiVersion: agentgateway.dev/v1alpha1
kind: AgentgatewayBackend
metadata:
  name: auto
spec:
  ai:
    groups:
      # Priority 1: Moonshot (use up credits)
      - providers:
          - name: moonshot-kimi
            openai:
              model: kimi-k2.5
            host: api.moonshot.ai
            port: 443
            policies:
              auth:
                secretRef:
                  name: moonshot-auth
              tls:
                sni: api.moonshot.ai
      # Priority 2: Modal
      - providers:
          - name: modal-gpt-oss
            openai:
              model: gpt-oss-120b
            host: solanyn--llm-gpt-oss-120b-serve.modal.run
            port: 443
            policies:
              auth:
                secretRef:
                  name: modal-llm-auth
              tls:
                sni: solanyn--llm-gpt-oss-120b-serve.modal.run
      # Priority 3: Kiro (local)
      - providers:
          - name: kiro
            openai:
              model: claude-opus-4
            host: mac.internal
            port: 8001
            policies:
              auth:
                secretRef:
                  name: kiro-auth
      # Priority 4: Free local MLX
      - providers:
          - name: mlx-ministral
            openai:
              model: ministral-8b
            host: mac.internal
            port: 8080
---
apiVersion: agentgateway.dev/v1alpha1
kind: AgentgatewayBackend
metadata:
  name: auto-coding
spec:
  ai:
    groups:
      # Priority 1: Moonshot (use up credits)
      - providers:
          - name: moonshot-kimi
            openai:
              model: kimi-k2.5
            host: api.moonshot.ai
            port: 443
            policies:
              auth:
                secretRef:
                  name: moonshot-auth
              tls:
                sni: api.moonshot.ai
      # Priority 2: Modal Devstral (coding optimised)
      - providers:
          - name: modal-devstral
            openai:
              model: devstral-24b
            host: solanyn--llm-devstral-small-2-24b-serve.modal.run
            port: 443
            policies:
              auth:
                secretRef:
                  name: modal-llm-auth
              tls:
                sni: solanyn--llm-devstral-small-2-24b-serve.modal.run
      # Priority 3: Kiro (local)
      - providers:
          - name: kiro
            openai:
              model: claude-opus-4
            host: mac.internal
            port: 8001
            policies:
              auth:
                secretRef:
                  name: kiro-auth
      # Priority 4: Free local MLX
      - providers:
          - name: mlx-ministral
            openai:
              model: ministral-8b
            host: mac.internal
            port: 8080
---
apiVersion: agentgateway.dev/v1alpha1
kind: AgentgatewayBackend
metadata:
  name: mlx-whisper
spec:
  ai:
    provider:
      openai:
        model: whisper-small
      host: mac.internal
      port: 8081
---
apiVersion: agentgateway.dev/v1alpha1
kind: AgentgatewayBackend
metadata:
  name: kiro
spec:
  ai:
    groups:
      - providers:
          - name: kiro-gateway
            openai:
              model: claude-sonnet-4-5
            host: mac.internal
            port: 8001
            policies:
              auth:
                secretRef:
                  name: kiro-auth
---
apiVersion: agentgateway.dev/v1alpha1
kind: AgentgatewayBackend
metadata:
  name: modal-gpt-oss
spec:
  ai:
    provider:
      openai:
        model: gpt-oss-120b
      host: solanyn--llm-gpt-oss-120b-serve.modal.run
      port: 443
      policies:
        auth:
          secretRef:
            name: modal-llm-auth
        tls:
          sni: solanyn--llm-gpt-oss-120b-serve.modal.run
---
apiVersion: agentgateway.dev/v1alpha1
kind: AgentgatewayBackend
metadata:
  name: modal-devstral
spec:
  ai:
    provider:
      openai:
        model: devstral-24b
      host: solanyn--llm-devstral-small-2-24b-serve.modal.run
      port: 443
      policies:
        auth:
          secretRef:
            name: modal-llm-auth
        tls:
          sni: solanyn--llm-devstral-small-2-24b-serve.modal.run
---
apiVersion: agentgateway.dev/v1alpha1
kind: AgentgatewayBackend
metadata:
  name: mlx-ministral
spec:
  ai:
    provider:
      openai:
        model: ministral-8b
      host: mac.internal
      port: 8080
