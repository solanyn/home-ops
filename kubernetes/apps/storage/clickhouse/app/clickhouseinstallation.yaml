---
apiVersion: clickhouse.altinity.com/v1
kind: ClickHouseInstallation
metadata:
  name: clickhouse
spec:
  configuration:
    users:
      collector/password_sha256_hex:
        valueFrom:
          secretKeyRef:
            name: clickhouse-secret
            key: collector-password
      collector/networks/ip:
        - 0.0.0.0/0
      grafana/password_sha256_hex:
        valueFrom:
          secretKeyRef:
            name: clickhouse-secret
            key: grafana-password
      grafana/networks/ip:
        - 0.0.0.0/0
      grafana/profile: readonly
      langfuse/password_sha256_hex:
        valueFrom:
          secretKeyRef:
            name: clickhouse-secret
            key: langfuse-password
      langfuse/networks/ip:
        - 0.0.0.0/0
    profiles:
      readonly/readonly: 1
    clusters:
      - name: default
        layout:
          shardsCount: 1
          replicasCount: 1
        templates:
          podTemplate: clickhouse
          volumeClaimTemplate: data
  defaults:
    templates:
      podTemplate: clickhouse
      volumeClaimTemplate: data
  templates:
    podTemplates:
      - name: clickhouse
        spec:
          containers:
            - name: clickhouse
              image: clickhouse/clickhouse-server:26.2
    volumeClaimTemplates:
      - name: data
        spec:
          accessModes:
            - ReadWriteOnce
          storageClassName: ceph-block
          resources:
            requests:
              storage: 50Gi
