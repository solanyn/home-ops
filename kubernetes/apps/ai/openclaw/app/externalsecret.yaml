---
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: &name openclaw
spec:
  secretStoreRef:
    kind: ClusterSecretStore
    name: onepassword
  target:
    name: *name
    creationPolicy: Owner
    template:
      data:
        OPENCLAW_GATEWAY_TOKEN: "{{ .OPENCLAW_GATEWAY_TOKEN }}"
        MOONSHOT_API_KEY: "{{ .MOONSHOT_API_KEY }}"
        OPENCLAW_SSH_PRIVATE_KEY: "{{ .OPENCLAW_SSH_PRIVATE_KEY }}"
        OPENCLAW_SSH_PUBLIC_KEY: "{{ .OPENCLAW_SSH_PUBLIC_KEY }}"
        GOOGLE_SERVICE_ACCOUNT_JSON: "{{ .GOOGLE_SERVICE_ACCOUNT_JSON }}"
        GOOGLE_PROJECT_NAME: "{{ .GOOGLE_PROJECT_NAME }}"
  dataFrom:
    - extract:
        key: openclaw
    - extract:
        key: moonshot
    - extract:
        key: google
---
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: &name openclaw-config
spec:
  secretStoreRef:
    kind: ClusterSecretStore
    name: onepassword
  target:
    name: *name
    creationPolicy: Owner
    template:
      data:
        openclaw.json: |
          {
            "agents": {
              "list": [
                {
                  "id": "main",
                  "default": true,
                  "name": "Assistant",
                  "workspace": "/home/node/.openclaw/workspace",
                  "model": {
                    "primary": "moonshot/kimi-k2.5",
                    "fallbacks": ["modal-gpt/gpt-oss-120b", "mlx/ministral-8b"]
                  }
                },
                {
                  "id": "coding",
                  "name": "Coder",
                  "workspace": "/home/node/.openclaw/workspace-coding",
                  "model": {
                    "primary": "modal-devstral/devstral-24b",
                    "fallbacks": ["mlx/ministral-8b"]
                  },
                  "tools": {
                    "allow": ["read", "write", "edit", "exec", "apply_patch", "browser"]
                  }
                }
              ]
            },
            "models": {
              "mode": "merge",
              "providers": {
                "moonshot": {
                  "baseUrl": "https://gateway.goyangi.io/v1/moonshot",
                  "apiKey": "{{ .AGENTGATEWAY_API_KEY }}",
                  "api": "openai-completions",
                  "models": [
                    {
                      "id": "kimi-k2.5",
                      "name": "Kimi K2.5"
                    }
                  ]
                },
                "mlx": {
                  "baseUrl": "https://gateway.goyangi.io/v1/ministral-8b",
                  "apiKey": "{{ .AGENTGATEWAY_API_KEY }}",
                  "api": "openai-completions",
                  "models": [
                    {
                      "id": "ministral-8b",
                      "name": "Ministral 8B (MLX)"
                    }
                  ]
                },
                "modal-devstral": {
                  "baseUrl": "https://gateway.goyangi.io/v1/devstral-small-2-24b",
                  "apiKey": "{{ .AGENTGATEWAY_API_KEY }}",
                  "api": "openai-completions",
                  "models": [
                    {
                      "id": "devstral-24b",
                      "name": "Devstral Small 24B"
                    }
                  ]
                },
                "modal-gpt": {
                  "baseUrl": "https://gateway.goyangi.io/v1/gpt-oss-120b",
                  "apiKey": "{{ .AGENTGATEWAY_API_KEY }}",
                  "api": "openai-completions",
                  "models": [
                    {
                      "id": "gpt-oss-120b",
                      "name": "GPT-OSS 120B"
                    }
                  ]
                }
              }
            },
            "gateway": {
              "mode": "local",
              "auth": {
                "mode": "token",
                "token": "{{ .OPENCLAW_GATEWAY_TOKEN }}"
              }
            },
            "channels": {
              "imessage": {
                "enabled": true,
                "cliPath": "/home/node/.local/bin/imsg-ssh",
                "remoteHost": "openclaw@mac.internal",
                "dbPath": "/Users/openclaw/Library/Messages/chat.db"
              }
            }
          }
  dataFrom:
    - extract:
        key: openclaw
    - extract:
        key: kgateway
