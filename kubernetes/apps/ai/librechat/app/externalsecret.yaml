# yaml-language-server: $schema=https://kubernetes-schemas.pages.dev/external-secrets.io/externalsecret_v1beta1.json
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: librechat
spec:
  secretStoreRef:
    kind: ClusterSecretStore
    name: onepassword
  target:
    name: librechat-secret
    creationPolicy: Owner
    template:
      data:
        MONGO_URI: "mongodb://{{ .FERRETDB_USER }}:{{ .FERRETDB_PASS }}@ferretdb.storage.svc.cluster.local:27017/LibreChat"
        MEILI_HOST: "http://meilisearch.ai.svc.cluster.local:7700"
        MEILI_MASTER_KEY: "{{ .MEILI_MASTER_KEY }}"
        REDIS_URI: "redis://redis.storage.svc.cluster.local:6379"
        CREDS_KEY: "{{ .LIBRECHAT_CREDS_KEY }}"
        CREDS_IV: "{{ .LIBRECHAT_CREDS_IV }}"
        JWT_SECRET: "{{ .LIBRECHAT_JWT_SECRET }}"
        JWT_REFRESH_SECRET: "{{ .LIBRECHAT_JWT_REFRESH_SECRET }}"
        OPENID_CLIENT_ID: "{{ .LIBRECHAT_CLIENT_ID }}"
        OPENID_CLIENT_SECRET: "{{ .LIBRECHAT_CLIENT_SECRET }}"
        OPENID_SESSION_SECRET: "{{ .LIBRECHAT_OPENID_SESSION_SECRET }}"
        OPENID_CALLBACK_URL: "/oauth/openid/callback"
        OPENID_SCOPE: "openid profile email"
        GITHUB_TOKEN: "{{ .GITHUB_MCP_SERVER_TOKEN }}"
        ENVOY_AI_GATEWAY_API_KEY: "{{ .AGENTGATEWAY_API_KEY }}"
  dataFrom:
    - extract:
        key: librechat
    - extract:
        key: ferretdb
    - extract:
        key: meilisearch
    - extract:
        key: github
    - extract:
        key: kgateway
