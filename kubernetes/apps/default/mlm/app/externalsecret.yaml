# yaml-language-server: $schema=https://kubernetes-schemas.pages.dev/external-secrets.io/externalsecret_v1.json
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: mlm
spec:
  secretStoreRef:
    kind: ClusterSecretStore
    name: onepassword
  target:
    name: mlm-secret
    creationPolicy: Owner
    template:
      data:
        config.toml: |
          mam_id = "{{ .MAM_ID }}"
          search_interval = 30
          goodreads_interval = 60
          link_interval = 5
          ebook_types = ["epub", "mobi", "azw3", "azw"]

          [[qbittorrent]]
          url = "http://qbittorrent.default.svc.cluster.local:80"
          username = "{{ .QBITTORRENT_USER }}"
          password = "{{ .QBITTORRENT_PASSWORD }}"

          [qbittorrent.on_cleaned]
          category = "seed"

          [[goodreads_list]]
          url = "https://www.goodreads.com/review/list_rss/183846728?key=W598YYloqd9PLmmP5XGPHxhJlv1_8zHKzy1c0Zy1Y-RQfC1Y&shelf=to-read"

          [[goodreads_list.grab]]
          cost = "try_wedge"
          categories = { audio = false, ebook = true }
          languages = ["english"]

          [[goodreads_list]]
          url = "https://www.goodreads.com/review/list_rss/183846728?key=W598YYloqd9PLmmP5XGPHxhJlv1_8zHKzy1c0Zy1Y-RQfC1Y&shelf=currently-reading"

          [[goodreads_list.grab]]
          cost = "try_wedge"
          categories = { audio = false, ebook = true }
          languages = ["english"]

          [[goodreads_list]]
          url = "https://www.goodreads.com/review/list_rss/183846728?key=W598YYloqd9PLmmP5XGPHxhJlv1_8zHKzy1c0Zy1Y-RQfC1Y&shelf=read"

          [[goodreads_list.grab]]
          cost = "try_wedge"
          categories = { audio = false, ebook = true }
          languages = ["english"]

          [[goodreads_list]]
          url = "https://www.goodreads.com/review/list_rss/182475532?key=Mmz5NOlthV2R-FRh7Y2dXL0_5HeGMLYfX0dChVZwXB8aFNYl&shelf=to-read"

          [[goodreads_list.grab]]
          cost = "try_wedge"
          categories = { audio = false, ebook = true }
          languages = ["english"]

          [[goodreads_list]]
          url = "https://www.goodreads.com/review/list_rss/182475532?key=Mmz5NOlthV2R-FRh7Y2dXL0_5HeGMLYfX0dChVZwXB8aFNYl&shelf=currently-reading"

          [[goodreads_list.grab]]
          cost = "try_wedge"
          categories = { audio = false, ebook = true }
          languages = ["english"]

          [[goodreads_list]]
          url = "https://www.goodreads.com/review/list_rss/182475532?key=Mmz5NOlthV2R-FRh7Y2dXL0_5HeGMLYfX0dChVZwXB8aFNYl&shelf=read"

          [[goodreads_list.grab]]
          cost = "try_wedge"
          categories = { audio = false, ebook = true }
          languages = ["english"]

          [[goodreads_list]]
          url = "https://www.goodreads.com/review/list_rss/183846728?key=W598YYloqd9PLmmP5XGPHxhJlv1_8zHKzy1c0Zy1Y-RQfC1Y&shelf=want-to-audio"

          [[goodreads_list.grab]]
          cost = "try_wedge"
          categories = { audio = true, ebook = false }
          languages = ["english"]

          [[goodreads_list]]
          url = "https://www.goodreads.com/review/list_rss/182475532?key=Mmz5NOlthV2R-FRh7Y2dXL0_5HeGMLYfX0dChVZwXB8aFNYl&shelf=want-to-audio"

          [[goodreads_list.grab]]
          cost = "try_wedge"
          categories = { audio = true, ebook = false }
          languages = ["english"]

          [[tag]]
          categories = { audio = true, ebook = false }
          category = "mlm-audiobooks"

          [[tag]]
          categories = { audio = false, ebook = true }
          category = "mlm-ebooks"
  dataFrom:
    - extract:
        key: myanonamouse
    - extract:
        key: qbittorrent
