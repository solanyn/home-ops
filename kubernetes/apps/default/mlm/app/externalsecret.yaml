# yaml-language-server: $schema=https://kubernetes-schemas.pages.dev/external-secrets.io/externalsecret_v1.json
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: mlm
spec:
  secretStoreRef:
    kind: ClusterSecretStore
    name: onepassword
  target:
    name: mlm-secret
    creationPolicy: Owner
    template:
      data:
        config.toml: |
          mam_id = "{{ .MAM_ID }}"

          [[qbittorrent]]
          url = "http://qbittorrent.default.svc.cluster.local:80"
          username = "{{ .QBITTORRENT_USERNAME }}"
          password = "{{ .QBITTORRENT_PASSWORD }}"

          [qbittorrent.on_cleaned]
          category = "Seed"

          [[autograb]]
          type = "bookmarks"
          cost = "free"

          [[autograb]]
          type = "bookmarks"
          cost = "all"
          max_size = "15 MiB"

          [[goodreads_list]]
          url = "https://www.goodreads.com/review/list_rss/183846728?key=W598YYloqd9PLmmP5XGPHxhJlv1_8zHKzy1c0Zy1Y-RQfC1Y&shelf=%23ALL%23"

          [[goodreads_list.grab]]
          cost = "free"

          [[goodreads_list]]
          url = "https://www.goodreads.com/review/list_rss/182475532?key=Mmz5NOlthV2R-FRh7Y2dXL0_5HeGMLYfX0dChVZwXB8aFNYl&shelf=%23ALL%23"

          [[goodreads_list.grab]]
          cost = "free"

          [[tag]]
          categories = { audio = true, ebook = false }
          category = "Audiobooks"

          [[tag]]
          categories = { audio = false, ebook = true }
          category = "Ebooks"

          [[library]]
          category = "Audiobooks"
          library_dir = "/media/bookdrop/audiobooks"
          method = "hardlink_or_copy"

          [[library]]
          category = "Ebooks"
          library_dir = "/media/bookdrop/ebooks"
          method = "hardlink_or_copy"
  dataFrom:
    - extract:
        key: myanonamouse
    - extract:
        key: qbittorrent
