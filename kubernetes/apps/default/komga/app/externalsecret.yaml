# yaml-language-server: $schema=https://kubernetes-schemas.pages.dev/external-secrets.io/externalsecret_v1beta1.json
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: komga
spec:
  secretStoreRef:
    kind: ClusterSecretStore
    name: onepassword
  target:
    name: komga-secret
    template:
      data:
        application.yml: |
          spring:
            security:
              oauth2:
                client:
                  registration:
                    pocket-id:
                      provider: pocket-id
                      client-id: "{{ .KOMGA_CLIENT_ID }}"
                      client-secret: "{{ .KOMGA_CLIENT_SECRET }}"
                      client-name: Pocket ID
                      scope: openid,email,profile
                      authorization-grant-type: authorization_code
                      redirect-uri: "{baseUrl}/{action}/oauth2/code/{registrationId}"
                  provider:
                    pocket-id:
                      user-name-attribute: sub
                      issuer-uri: https://id.goyangi.io
  dataFrom:
    - extract:
        key: komga
