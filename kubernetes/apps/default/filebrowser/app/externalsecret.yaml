# yaml-language-server: $schema=https://kubernetes-schemas.pages.dev/external-secrets.io/externalsecret_v1beta1.json
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: filebrowser
spec:
  secretStoreRef:
    kind: ClusterSecretStore
    name: onepassword
  target:
    name: filebrowser-secret
    template:
      data:
        config.yaml: |
          server:
            port: 80
            database: "/config/database.db"
            sources:
              - path: "/data"
                config:
                  defaultEnabled: true
                  defaultUserScope: "/"
                  createUserDir: false
          auth:
            methods:
              password:
                enabled: false
              oidc:
                enabled: true
                clientId: "{{ .FILEBROWSER_OIDC_CLIENT_ID }}"
                clientSecret: "{{ .FILEBROWSER_OIDC_CLIENT_SECRET }}"
                issuerUrl: "https://id.goyangi.io"
                logoutRedirectUrl: "https://filebrowser.goyangi.io/logout"
                scopes: "email openid profile groups"
                userIdentifier: "preferred_username"
                createUser: true
                adminGroup: "admin"
          userDefaults:
            permissions:
              download: true
  dataFrom:
    - extract:
        key: filebrowser
