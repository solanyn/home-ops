# yaml-language-server: $schema=https://json.schemastore.org/kustomization
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
resources:
  - ../../../../../third_party/kubeflow/manifests/common/istio/istio-install/base
configMapGenerator:
  - name: istio-sidecar-injector
    namespace: istio-system
    behavior: merge
    files:
      - values=./resources/values.json
generatorOptions:
  disableNameSuffixHash: false
patchesStrategicMerge:
  - patches/patch.istio-configmap.yaml
patches:
  - target:
      kind: AuthorizationPolicy
      name: istio-ingressgateway
      namespace: istio-system
    patch: |
      $patch: delete
      apiVersion: security.istio.io/v1
      kind: AuthorizationPolicy
      metadata:
        name: istio-ingressgateway
        namespace: istio-system
  - target:
      kind: Deployment
    patch: |
      apiVersion: apps/v1
      kind: Deployment
      metadata:
        name: this-is-ignored
      spec:
        template:
          metadata:
            annotations:
              reloader.stakater.com/auto: "true"
