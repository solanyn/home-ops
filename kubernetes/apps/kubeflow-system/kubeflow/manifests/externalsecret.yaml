# yaml-language-server: $schema=https://kubernetes-schemas.solanyn.dev/external-secrets.io/externalsecret_v1.json
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: mlpipeline-db-credentials
  namespace: kubeflow
spec:
  secretStoreRef:
    kind: ClusterSecretStore
    name: onepassword
  target:
    creationPolicy: Merge
    name: mlpipeline-db-credentials
    template:
      data:
        username: "root"
        password: "{{ .MARIADB_ROOT_PASSWORD }}"
  dataFrom:
    - extract:
        key: mariadb
---
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: metadata-db-secrets
  namespace: kubeflow
spec:
  secretStoreRef:
    kind: ClusterSecretStore
    name: onepassword
  target:
    creationPolicy: Merge
    name: metadata-db-secrets
    template:
      data:
        MYSQL_USER_NAME: root
        MYSQL_ROOT_PASSWORD: "{{ .MARIADB_ROOT_PASSWORD }}"
  dataFrom:
    - extract:
        key: mariadb
---
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: mlpipeline-minio-artifact
  namespace: kubeflow
spec:
  secretStoreRef:
    kind: ClusterSecretStore
    name: onepassword
  target:
    creationPolicy: Merge
    name: mlpipeline-minio-artifact
    template:
      data:
        accesskey: "{{ .MINIO_ROOT_USER }}"
        secretkey: "{{ .MINIO_ROOT_PASSWORD }}"
  dataFrom:
    - extract:
        key: minio
---
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: katib-mysql-secrets
  namespace: kubeflow
spec:
  secretStoreRef:
    kind: ClusterSecretStore
    name: onepassword
  target:
    creationPolicy: Merge
    name: katib-mysql-secrets
    template:
      data:
        KATIB_MYSQL_DB_DATABASE: katib
        KATIB_MYSQL_DB_HOST: mariadb.database.svc.cluster.local
        KATIB_MYSQL_DB_PORT: "3306"
        DB_USER: "root"
        DB_PASSWORD: "{{ .MARIADB_ROOT_PASSWORD }}"
  dataFrom:
    - extract:
        key: mariadb
---
kind: Secret
apiVersion: v1
metadata:
  name: mysql-secret
stringData:
  username: root
  password: ""
---
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: mysql-secret
  namespace: kubeflow
spec:
  secretStoreRef:
    kind: ClusterSecretStore
    name: onepassword
  target:
    creationPolicy: Merge
    name: mysql-secret
    template:
      data:
        username: root
        password: "{{ .MARIADB_ROOT_PASSWORD }}"
  dataFrom:
    - extract:
        key: mariadb
