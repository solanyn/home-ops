apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
namespace: knative-serving
resources:
  - https://github.com/knative/serving/releases/download/knative-v1.20.1/serving-core.yaml
  - https://github.com/knative-extensions/net-gateway-api/releases/download/knative-v1.20.1/net-gateway-api.yaml

patches:
  - target:
      kind: ConfigMap
      name: config-network
    patch: |
      - op: add
        path: /data/ingress-class
        value: gateway-api.ingress.networking.knative.dev
  - target:
      kind: ConfigMap
      name: config-gateway
    patch: |
      - op: add
        path: /data/external-gateways
        value: |
          - class: envoy-gateway.gateway.networking.k8s.io
            gateway: network/envoy-internal
            service: network/envoy-internal
      - op: add
        path: /data/local-gateways
        value: |
          - class: envoy-gateway.gateway.networking.k8s.io
            gateway: network/envoy-internal
            service: network/envoy-internal
